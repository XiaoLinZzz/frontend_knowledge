# XSS 和 CSRF 攻击

## CSRF 攻击

Cross-site request forgery，跨站请求伪造。

控制用户在当前已登陆的web应用上执行非本意操作的攻击方法。攻击者利用的是存在浏览器中的 cookie。

它首先引导用户访问一个危险网站，当用户访问网站后，网站会发送请求到被攻击的站点，这次请求会携带用户的cookie发送，因此就利用了用户的身份信息完成攻击



<img src="/Users/lujiema/Documents/typora-user-images/Screenshot 2025-01-06 at 8.47.33 PM.png" alt="Screenshot 2025-01-06 at 8.47.33 PM" style="zoom:50%;" />



### 防御方式

| 防御手段            | 描述                                                         |
| ------------------- | ------------------------------------------------------------ |
| 使用验证码          | 确保操作是用户自己的本意执行                                 |
| 使用 samesite       | 设置在 HTTP 首部，阻止浏览器发送 cookie<br />Samesite = Strict/Lax -- Lax 相对缓和，允许 GET 请求自动携带cookie |
| 使用 csrf token     | 获取到token后进行操作依然会被攻击                            |
| 内容安全策略（CSP） | 限制可以执行的资源，减少攻击面                               |
| 同源策略            | 确保只有相同源的请求才被接受                                 |



## XSS 攻击

Cross Site Scripting，跨站脚本攻击

攻击者利用站点漏洞，在表单提交时，在表单内容加入一些恶意脚本，当其他正常用户浏览页面，而页面中刚好出现攻击者的恶意脚本时，脚本被执行，从而导致页面遭到破坏，或者用户信息被窃取



### 反射型

将不可信的数据插入到 例如 ?qurey=xxxx 后面，如果服务器没有进行特殊的处理，这段代码会被执行



### 存储型

如果允许发表评论 直接在评论的时候打 script 标签，然后会存在服务器内，后续有人进行访问，就会跳出这段script



### DOM 型

url中包含 #xxx，本身是为了方便进行跳转。但是如果往这里注入恶意代码，会导致在 js 中直接执行代码



### 防御方式

服务器端对用户提交的内容进行过滤和编码

- **数据过滤**：对用户的输入进行过滤，过滤特殊字符。
- **内容安全策略（CSP）**：比如在 js 中，使用 `textContent` 而不是 `innerHTML` 来设置元素内容，因为 `textContent` 不会解析 HTML 标签。
- **编码输出**：在输出内容到页面之前，对可能的危险字符进行编码。
- **使用 HTTP only Cookies**：通过设置 cookie 的 http only 属性，使 Js 脚本无法访问 cookie，减少了 XSS 攻击的风险。
- **输入验证**：对从外部获取的数据进行验证，确保他们符合预期的格式
- **定期更新和打补丁**：保持 Web 应用的框架和库是最新的，以利用最新的安全修复。





















